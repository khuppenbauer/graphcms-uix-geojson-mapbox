import React, { useEffect, useRef } from 'react';
import {
  Wrapper,
  useUiExtension,
  FieldExtensionType,
  FieldExtensionFeature,
} from '@graphcms/uix-react-sdk';
import mapboxgl from 'mapbox-gl';
import 'mapbox-gl/dist/mapbox-gl.css';

mapboxgl.workerClass = require('worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker').default;

const mapboxToken = process.env.REACT_APP_MAPBOX_ACCESS_TOKEN;

const geoJson = {
  "type": "FeatureCollection",
  "features": [{
      "type": "Feature",
      "properties": {
          "name": "Moemoea Trail",
          "time": "2021-04-18T11:44:06Z",
          "_gpxType": "trk",
          "coordTimes": ["2021-04-18T11:44:06Z", "2021-04-18T11:44:09Z", "2021-04-18T11:44:14Z", "2021-04-18T11:44:24Z", "2021-04-18T11:44:27Z", "2021-04-18T11:44:34Z", "2021-04-18T11:44:38Z", "2021-04-18T11:44:41Z", "2021-04-18T11:44:44Z", "2021-04-18T11:44:47Z", "2021-04-18T11:44:51Z", "2021-04-18T11:44:54Z", "2021-04-18T11:44:58Z", "2021-04-18T11:45:01Z", "2021-04-18T11:45:04Z", "2021-04-18T11:45:07Z", "2021-04-18T11:45:11Z", "2021-04-18T11:45:17Z", "2021-04-18T11:45:20Z", "2021-04-18T11:45:22Z", "2021-04-18T11:45:28Z", "2021-04-18T11:45:31Z", "2021-04-18T11:45:34Z", "2021-04-18T11:45:36Z", "2021-04-18T11:45:39Z", "2021-04-18T11:45:41Z", "2021-04-18T11:45:48Z", "2021-04-18T11:45:52Z", "2021-04-18T11:45:55Z", "2021-04-18T11:45:57Z", "2021-04-18T11:45:59Z", "2021-04-18T11:46:02Z", "2021-04-18T11:46:05Z", "2021-04-18T11:46:12Z", "2021-04-18T11:46:15Z", "2021-04-18T11:46:21Z", "2021-04-18T11:46:26Z", "2021-04-18T11:46:29Z", "2021-04-18T11:46:33Z", "2021-04-18T11:46:45Z", "2021-04-18T11:46:51Z", "2021-04-18T11:46:54Z", "2021-04-18T11:46:58Z", "2021-04-18T11:47:11Z", "2021-04-18T11:47:15Z", "2021-04-18T11:47:19Z", "2021-04-18T11:47:22Z", "2021-04-18T11:47:33Z", "2021-04-18T11:47:36Z", "2021-04-18T11:47:44Z", "2021-04-18T11:47:47Z", "2021-04-18T11:47:54Z", "2021-04-18T11:47:58Z", "2021-04-18T11:48:04Z", "2021-04-18T11:48:11Z", "2021-04-18T11:48:15Z", "2021-04-18T11:48:18Z", "2021-04-18T11:48:20Z", "2021-04-18T11:48:23Z", "2021-04-18T11:48:26Z", "2021-04-18T11:48:31Z", "2021-04-18T11:48:33Z", "2021-04-18T11:48:43Z", "2021-04-18T11:48:49Z", "2021-04-18T11:48:51Z", "2021-04-18T11:48:53Z", "2021-04-18T11:49:05Z", "2021-04-18T11:49:08Z", "2021-04-18T11:49:25Z", "2021-04-18T11:49:47Z", "2021-04-18T11:49:54Z", "2021-04-18T11:50:04Z", "2021-04-18T11:50:09Z", "2021-04-18T11:50:15Z", "2021-04-18T11:50:22Z", "2021-04-18T11:50:30Z", "2021-04-18T11:50:35Z", "2021-04-18T11:50:37Z", "2021-04-18T11:50:45Z", "2021-04-18T11:50:55Z", "2021-04-18T11:51:02Z", "2021-04-18T11:51:22Z", "2021-04-18T11:52:15Z", "2021-04-18T11:52:23Z", "2021-04-18T11:52:35Z", "2021-04-18T11:52:51Z", "2021-04-18T11:52:59Z", "2021-04-18T11:53:10Z", "2021-04-18T11:59:32Z", "2021-04-18T11:59:39Z", "2021-04-18T11:59:53Z", "2021-04-18T11:59:57Z", "2021-04-18T12:00:04Z", "2021-04-18T12:01:06Z", "2021-04-18T12:01:37Z", "2021-04-18T12:01:44Z", "2021-04-18T12:01:46Z", "2021-04-18T12:01:49Z", "2021-04-18T12:01:53Z", "2021-04-18T12:01:56Z", "2021-04-18T12:02:02Z", "2021-04-18T12:02:12Z", "2021-04-18T12:02:26Z", "2021-04-18T12:02:32Z", "2021-04-18T12:02:55Z", "2021-04-18T12:03:06Z", "2021-04-18T12:03:11Z", "2021-04-18T12:03:16Z", "2021-04-18T12:03:28Z", "2021-04-18T12:03:43Z", "2021-04-18T12:03:46Z", "2021-04-18T12:03:49Z", "2021-04-18T12:03:51Z", "2021-04-18T12:03:58Z", "2021-04-18T12:04:04Z", "2021-04-18T12:04:09Z", "2021-04-18T12:04:16Z", "2021-04-18T12:04:19Z", "2021-04-18T12:04:25Z", "2021-04-18T12:04:29Z", "2021-04-18T12:04:31Z", "2021-04-18T12:04:33Z", "2021-04-18T12:04:36Z", "2021-04-18T12:04:38Z", "2021-04-18T12:04:44Z", "2021-04-18T12:04:47Z", "2021-04-18T12:04:49Z", "2021-04-18T12:04:51Z", "2021-04-18T12:04:53Z", "2021-04-18T12:04:57Z", "2021-04-18T12:04:59Z", "2021-04-18T12:05:04Z", "2021-04-18T12:05:06Z", "2021-04-18T12:05:08Z", "2021-04-18T12:05:10Z", "2021-04-18T12:05:18Z", "2021-04-18T12:05:22Z", "2021-04-18T12:05:28Z", "2021-04-18T12:05:43Z", "2021-04-18T12:05:49Z", "2021-04-18T12:05:54Z", "2021-04-18T12:05:57Z", "2021-04-18T12:06:11Z", "2021-04-18T12:06:15Z", "2021-04-18T12:06:20Z", "2021-04-18T12:06:25Z", "2021-04-18T12:06:31Z", "2021-04-18T12:06:34Z", "2021-04-18T12:06:39Z", "2021-04-18T12:06:48Z", "2021-04-18T12:06:58Z", "2021-04-18T12:07:03Z", "2021-04-18T12:07:09Z", "2021-04-18T12:07:13Z", "2021-04-18T12:07:18Z", "2021-04-18T12:07:23Z", "2021-04-18T12:07:33Z", "2021-04-18T12:08:03Z", "2021-04-18T12:08:06Z", "2021-04-18T12:08:09Z", "2021-04-18T12:08:12Z", "2021-04-18T12:08:18Z", "2021-04-18T12:08:24Z", "2021-04-18T12:08:26Z", "2021-04-18T12:08:29Z", "2021-04-18T12:08:39Z", "2021-04-18T12:08:42Z", "2021-04-18T12:08:52Z", "2021-04-18T12:08:57Z", "2021-04-18T12:09:02Z", "2021-04-18T12:09:04Z", "2021-04-18T12:09:07Z", "2021-04-18T12:09:10Z", "2021-04-18T12:09:13Z", "2021-04-18T12:09:19Z", "2021-04-18T12:09:27Z", "2021-04-18T12:09:34Z", "2021-04-18T12:09:40Z", "2021-04-18T12:09:50Z", "2021-04-18T12:09:54Z", "2021-04-18T12:10:03Z", "2021-04-18T12:10:12Z", "2021-04-18T12:10:18Z", "2021-04-18T12:10:27Z", "2021-04-18T12:10:32Z", "2021-04-18T12:10:38Z", "2021-04-18T12:10:41Z", "2021-04-18T12:10:44Z", "2021-04-18T12:10:46Z", "2021-04-18T12:10:49Z", "2021-04-18T12:10:52Z", "2021-04-18T12:10:57Z", "2021-04-18T12:11:05Z", "2021-04-18T12:11:09Z", "2021-04-18T12:11:13Z", "2021-04-18T12:11:15Z", "2021-04-18T12:11:18Z", "2021-04-18T12:11:21Z", "2021-04-18T12:11:27Z", "2021-04-18T12:11:29Z", "2021-04-18T12:11:31Z", "2021-04-18T12:11:33Z", "2021-04-18T12:11:36Z", "2021-04-18T12:11:41Z", "2021-04-18T12:11:47Z", "2021-04-18T12:11:49Z", "2021-04-18T12:11:55Z", "2021-04-18T12:11:58Z", "2021-04-18T12:12:01Z", "2021-04-18T12:12:15Z", "2021-04-18T12:12:18Z", "2021-04-18T12:12:40Z", "2021-04-18T12:12:43Z", "2021-04-18T12:12:46Z", "2021-04-18T12:12:48Z", "2021-04-18T12:12:51Z", "2021-04-18T12:12:53Z", "2021-04-18T12:12:59Z", "2021-04-18T12:13:01Z", "2021-04-18T12:13:05Z", "2021-04-18T12:13:07Z", "2021-04-18T12:13:10Z", "2021-04-18T12:13:16Z", "2021-04-18T12:13:19Z", "2021-04-18T12:13:32Z", "2021-04-18T12:13:38Z", "2021-04-18T12:13:44Z", "2021-04-18T12:13:51Z", "2021-04-18T12:13:53Z", "2021-04-18T12:13:58Z", "2021-04-18T12:13:59Z", "2021-04-18T12:14:02Z", "2021-04-18T12:14:05Z", "2021-04-18T12:14:08Z", "2021-04-18T12:14:09Z", "2021-04-18T12:14:13Z", "2021-04-18T12:14:16Z", "2021-04-18T12:14:19Z", "2021-04-18T12:14:22Z", "2021-04-18T12:14:24Z", "2021-04-18T12:14:27Z", "2021-04-18T12:14:31Z", "2021-04-18T12:14:35Z", "2021-04-18T12:14:37Z", "2021-04-18T12:14:39Z", "2021-04-18T12:14:43Z", "2021-04-18T12:14:45Z", "2021-04-18T12:14:48Z", "2021-04-18T12:14:50Z", "2021-04-18T12:14:53Z", "2021-04-18T12:14:56Z", "2021-04-18T12:14:58Z", "2021-04-18T12:15:07Z", "2021-04-18T12:15:16Z", "2021-04-18T12:15:20Z", "2021-04-18T12:15:29Z", "2021-04-18T12:15:37Z", "2021-04-18T12:15:41Z", "2021-04-18T12:16:44Z", "2021-04-18T12:16:58Z", "2021-04-18T12:17:01Z", "2021-04-18T12:17:03Z", "2021-04-18T12:17:17Z", "2021-04-18T12:17:18Z", "2021-04-18T12:17:23Z", "2021-04-18T12:17:25Z", "2021-04-18T12:17:27Z", "2021-04-18T12:17:30Z", "2021-04-18T12:17:32Z", "2021-04-18T12:17:35Z", "2021-04-18T12:17:38Z", "2021-04-18T12:17:41Z", "2021-04-18T12:17:43Z", "2021-04-18T12:17:46Z", "2021-04-18T12:17:49Z", "2021-04-18T12:17:53Z", "2021-04-18T12:17:55Z", "2021-04-18T12:17:57Z", "2021-04-18T12:18:03Z", "2021-04-18T12:18:30Z", "2021-04-18T12:18:51Z", "2021-04-18T12:18:58Z", "2021-04-18T12:19:05Z", "2021-04-18T12:19:12Z", "2021-04-18T12:19:21Z", "2021-04-18T12:19:35Z", "2021-04-18T12:20:01Z", "2021-04-18T12:20:07Z", "2021-04-18T12:20:12Z", "2021-04-18T12:20:19Z", "2021-04-18T12:20:27Z", "2021-04-18T12:20:40Z", "2021-04-18T12:21:11Z", "2021-04-18T12:21:18Z", "2021-04-18T12:21:24Z", "2021-04-18T12:21:36Z", "2021-04-18T12:21:50Z", "2021-04-18T12:22:33Z", "2021-04-18T12:25:47Z", "2021-04-18T12:27:00Z", "2021-04-18T12:27:07Z", "2021-04-18T12:27:22Z", "2021-04-18T12:28:26Z", "2021-04-18T12:29:19Z", "2021-04-18T12:29:24Z", "2021-04-18T12:29:30Z", "2021-04-18T12:29:35Z", "2021-04-18T12:29:41Z", "2021-04-18T12:29:48Z", "2021-04-18T12:29:53Z", "2021-04-18T12:29:57Z", "2021-04-18T12:30:03Z", "2021-04-18T12:30:12Z", "2021-04-18T12:30:17Z", "2021-04-18T12:30:37Z", "2021-04-18T12:30:49Z", "2021-04-18T12:34:40Z", "2021-04-18T12:34:44Z", "2021-04-18T12:34:49Z", "2021-04-18T12:34:52Z", "2021-04-18T12:34:56Z", "2021-04-18T12:35:00Z", "2021-04-18T12:35:03Z", "2021-04-18T12:35:53Z", "2021-04-18T12:44:32Z", "2021-04-18T12:44:59Z", "2021-04-18T12:45:02Z", "2021-04-18T12:45:11Z", "2021-04-18T12:45:16Z", "2021-04-18T12:45:24Z", "2021-04-18T12:45:28Z", "2021-04-18T12:46:37Z", "2021-04-18T12:50:57Z", "2021-04-18T12:51:03Z", "2021-04-18T12:51:12Z", "2021-04-18T12:51:18Z", "2021-04-18T12:51:26Z", "2021-04-18T12:51:36Z", "2021-04-18T12:51:42Z", "2021-04-18T12:51:48Z", "2021-04-18T12:51:55Z", "2021-04-18T12:52:03Z", "2021-04-18T12:52:09Z", "2021-04-18T12:52:47Z", "2021-04-18T12:52:50Z", "2021-04-18T12:52:55Z", "2021-04-18T12:53:07Z", "2021-04-18T12:53:14Z", "2021-04-18T12:53:17Z", "2021-04-18T12:53:20Z", "2021-04-18T12:53:26Z", "2021-04-18T12:53:29Z", "2021-04-18T12:53:35Z", "2021-04-18T12:53:42Z", "2021-04-18T12:53:54Z", "2021-04-18T12:53:57Z", "2021-04-18T12:54:00Z", "2021-04-18T12:54:05Z", "2021-04-18T12:54:08Z", "2021-04-18T12:54:13Z", "2021-04-18T12:54:17Z", "2021-04-18T12:54:23Z", "2021-04-18T12:54:26Z", "2021-04-18T12:54:38Z", "2021-04-18T12:54:41Z", "2021-04-18T12:54:47Z", "2021-04-18T12:54:52Z", "2021-04-18T12:54:58Z", "2021-04-18T12:55:04Z", "2021-04-18T12:55:11Z", "2021-04-18T12:55:20Z", "2021-04-18T12:55:22Z", "2021-04-18T12:55:25Z", "2021-04-18T12:55:27Z", "2021-04-18T12:55:30Z", "2021-04-18T12:55:32Z", "2021-04-18T12:55:37Z", "2021-04-18T12:55:39Z", "2021-04-18T12:55:46Z", "2021-04-18T12:55:50Z", "2021-04-18T12:55:53Z", "2021-04-18T12:55:57Z", "2021-04-18T12:56:00Z", "2021-04-18T12:56:02Z", "2021-04-18T12:56:04Z", "2021-04-18T12:56:07Z", "2021-04-18T12:56:12Z", "2021-04-18T12:56:15Z", "2021-04-18T12:56:18Z", "2021-04-18T12:56:21Z", "2021-04-18T12:56:29Z", "2021-04-18T12:56:32Z", "2021-04-18T12:56:36Z", "2021-04-18T12:56:44Z", "2021-04-18T12:56:48Z", "2021-04-18T12:56:52Z", "2021-04-18T12:56:55Z", "2021-04-18T12:56:57Z", "2021-04-18T12:56:59Z", "2021-04-18T12:57:24Z", "2021-04-18T12:57:26Z", "2021-04-18T12:57:32Z", "2021-04-18T12:57:39Z", "2021-04-18T12:57:45Z", "2021-04-18T12:57:52Z", "2021-04-18T12:57:55Z", "2021-04-18T12:57:58Z", "2021-04-18T12:58:01Z", "2021-04-18T12:58:06Z", "2021-04-18T12:58:12Z", "2021-04-18T12:58:17Z", "2021-04-18T12:58:20Z", "2021-04-18T12:58:23Z", "2021-04-18T12:58:27Z", "2021-04-18T12:58:32Z", "2021-04-18T12:58:39Z", "2021-04-18T12:58:45Z", "2021-04-18T13:00:17Z", "2021-04-18T13:00:37Z", "2021-04-18T13:00:41Z", "2021-04-18T13:00:50Z", "2021-04-18T13:01:00Z", "2021-04-18T13:01:08Z", "2021-04-18T13:01:30Z", "2021-04-18T13:01:33Z", "2021-04-18T13:01:46Z", "2021-04-18T13:01:56Z", "2021-04-18T13:02:00Z", "2021-04-18T13:02:06Z", "2021-04-18T13:02:11Z", "2021-04-18T13:02:38Z", "2021-04-18T13:02:47Z", "2021-04-18T13:02:52Z", "2021-04-18T13:02:55Z", "2021-04-18T13:02:57Z", "2021-04-18T13:03:00Z", "2021-04-18T13:03:03Z", "2021-04-18T13:03:11Z", "2021-04-18T13:03:24Z", "2021-04-18T13:03:35Z", "2021-04-18T13:03:43Z", "2021-04-18T13:03:44Z", "2021-04-18T13:03:49Z", "2021-04-18T13:03:58Z", "2021-04-18T13:04:04Z", "2021-04-18T13:04:06Z", "2021-04-18T13:04:10Z", "2021-04-18T13:04:11Z", "2021-04-18T13:04:13Z", "2021-04-18T13:04:19Z", "2021-04-18T13:04:23Z", "2021-04-18T13:04:24Z", "2021-04-18T13:04:27Z", "2021-04-18T13:04:31Z", "2021-04-18T13:04:33Z", "2021-04-18T13:04:35Z", "2021-04-18T13:04:38Z", "2021-04-18T13:04:40Z", "2021-04-18T13:04:44Z", "2021-04-18T13:04:46Z", "2021-04-18T13:04:48Z", "2021-04-18T13:04:49Z", "2021-04-18T13:04:56Z", "2021-04-18T13:05:00Z", "2021-04-18T13:05:03Z", "2021-04-18T13:05:06Z", "2021-04-18T13:05:09Z", "2021-04-18T13:05:12Z", "2021-04-18T13:05:14Z", "2021-04-18T13:05:17Z", "2021-04-18T13:05:20Z", "2021-04-18T13:05:28Z", "2021-04-18T13:05:31Z", "2021-04-18T13:05:40Z", "2021-04-18T13:05:48Z", "2021-04-18T13:05:52Z", "2021-04-18T13:05:56Z", "2021-04-18T13:05:58Z", "2021-04-18T13:06:06Z", "2021-04-18T13:06:10Z", "2021-04-18T13:06:12Z", "2021-04-18T13:06:26Z", "2021-04-18T13:06:40Z", "2021-04-18T13:06:44Z", "2021-04-18T13:07:24Z", "2021-04-18T13:07:30Z", "2021-04-18T13:07:41Z", "2021-04-18T13:07:53Z", "2021-04-18T13:08:05Z", "2021-04-18T13:08:12Z", "2021-04-18T13:09:19Z", "2021-04-18T13:09:33Z", "2021-04-18T13:10:32Z", "2021-04-18T13:11:28Z", "2021-04-18T13:11:38Z", "2021-04-18T13:11:41Z", "2021-04-18T13:11:44Z", "2021-04-18T13:11:48Z", "2021-04-18T13:11:50Z", "2021-04-18T13:11:52Z"],
          "color": "red",
          "type": "track"
      },
      "geometry": {
          "type": "LineString",
          "coordinates": [
              [9.792067, 48.800906, 322.4],
              [9.792001, 48.80097, 322.4],
              [9.791915, 48.801032, 322.3],
              [9.791848, 48.801241, 322.1],
              [9.791795, 48.801327, 322.1],
              [9.791602, 48.80153, 322],
              [9.791466, 48.801604, 322],
              [9.791332, 48.801654, 322.1],
              [9.791203, 48.801673, 322],
              [9.791044, 48.801653, 321.9],
              [9.790858, 48.801648, 321.7],
              [9.790745, 48.801704, 321.7],
              [9.790647, 48.801776, 321.8],
              [9.790627, 48.801865, 321.9],
              [9.790753, 48.801933, 321.9],
              [9.790964, 48.80198, 322],
              [9.791242, 48.801994, 322.3],
              [9.791656, 48.802081, 323],
              [9.791845, 48.80211, 323.4],
              [9.791974, 48.802119, 323.8],
              [9.792255, 48.802116, 324.4],
              [9.792413, 48.802123, 324.6],
              [9.792579, 48.802151, 324.8],
              [9.79271, 48.802209, 324.9],
              [9.792857, 48.802203, 324.9],
              [9.792986, 48.802223, 324.9],
              [9.793364, 48.802319, 324.8],
              [9.793671, 48.80244, 324.6],
              [9.793851, 48.802492, 324.5],
              [9.793994, 48.802544, 324.4],
              [9.79413, 48.802571, 324.4],
              [9.794319, 48.802624, 324.4],
              [9.794506, 48.802699, 324.4],
              [9.79483, 48.802859, 324.5],
              [9.794997, 48.8029, 324.7],
              [9.795373, 48.802966, 324.9],
              [9.795659, 48.80304, 325.3],
              [9.795822, 48.803096, 325.5],
              [9.796077, 48.803152, 326.1],
              [9.796607, 48.803298, 328],
              [9.796767, 48.803319, 328.3],
              [9.796913, 48.803354, 328.4],
              [9.797054, 48.803411, 328.3],
              [9.797889, 48.803658, 328.2],
              [9.798092, 48.803744, 328.3],
              [9.798289, 48.803848, 328.5],
              [9.798392, 48.803921, 328.7],
              [9.798749, 48.804217, 329],
              [9.798865, 48.804291, 329.1],
              [9.799242, 48.804472, 329.4],
              [9.799398, 48.804518, 329.5],
              [9.79978, 48.804598, 329.8],
              [9.8, 48.804672, 330.1],
              [9.800269, 48.804731, 330.3],
              [9.80051, 48.804798, 330.5],
              [9.800621, 48.804763, 330.6],
              [9.800749, 48.804697, 330.3],
              [9.800856, 48.80466, 330.1],
              [9.801008, 48.804637, 329.5],
              [9.801118, 48.804675, 329.3],
              [9.80106, 48.804946, 329.6],
              [9.801009, 48.805029, 329.7],
              [9.800882, 48.805347, 330.5],
              [9.800826, 48.805539, 331.1],
              [9.800817, 48.805615, 331.2],
              [9.800789, 48.805689, 331.4],
              [9.800732, 48.806134, 332.3],
              [9.800735, 48.80624, 332.3],
              [9.801017, 48.806682, 336.3],
              [9.80109, 48.807033, 342.3],
              [9.801093, 48.807117, 343.5],
              [9.801046, 48.80729, 345.6],
              [9.800997, 48.807362, 346.6],
              [9.800922, 48.807419, 347.5],
              [9.800815, 48.807453, 348.8],
              [9.800747, 48.807513, 350.1],
              [9.800707, 48.807588, 351.2],
              [9.800716, 48.807679, 352.5],
              [9.800771, 48.807866, 354.4],
              [9.800782, 48.808056, 357.2],
              [9.800771, 48.808142, 359.5],
              [9.800883, 48.808137, 363],
              [9.801165, 48.80819, 369.8],
              [9.801257, 48.808233, 372.1],
              [9.80132, 48.8083, 374.2],
              [9.801346, 48.808376, 376],
              [9.801395, 48.808444, 377.5],
              [9.801607, 48.808539, 381.6],
              [9.801786, 48.808866, 388.6],
              [9.801861, 48.809036, 392.1],
              [9.802142, 48.809195, 398.6],
              [9.802214, 48.809254, 400.6],
              [9.802267, 48.809323, 402.6],
              [9.802557, 48.809454, 409],
              [9.802821, 48.809556, 414.1],
              [9.802886, 48.809635, 416],
              [9.802922, 48.809711, 417.6],
              [9.802989, 48.809792, 419.3],
              [9.803079, 48.809873, 421.3],
              [9.803202, 48.809953, 423.7],
              [9.803306, 48.809993, 425.5],
              [9.80339, 48.810043, 426.3],
              [9.803275, 48.810183, 427.1],
              [9.803162, 48.810245, 427.8],
              [9.802902, 48.810558, 429.9],
              [9.802639, 48.810784, 430.2],
              [9.802422, 48.810915, 429.9],
              [9.802227, 48.811056, 430],
              [9.801896, 48.811336, 431.1],
              [9.801488, 48.811596, 430.6],
              [9.801376, 48.8117, 429.9],
              [9.801197, 48.81177, 429.2],
              [9.801082, 48.811831, 429],
              [9.800835, 48.811988, 428.9],
              [9.800698, 48.812158, 428.8],
              [9.800427, 48.812348, 428.2],
              [9.800101, 48.812452, 427.7],
              [9.799973, 48.812502, 427.6],
              [9.799706, 48.812629, 427.2],
              [9.799551, 48.812746, 426.7],
              [9.799501, 48.812822, 426.4],
              [9.799466, 48.812903, 426.2],
              [9.799397, 48.812989, 426],
              [9.799298, 48.813087, 425.9],
              [9.79912, 48.813221, 425.7],
              [9.798955, 48.813306, 425.2],
              [9.798836, 48.813395, 424.5],
              [9.798737, 48.813489, 423.8],
              [9.798677, 48.813602, 423.3],
              [9.798725, 48.813884, 422.3],
              [9.798716, 48.813984, 421.9],
              [9.798648, 48.81412, 421.3],
              [9.798657, 48.814201, 421.1],
              [9.798767, 48.814314, 420.8],
              [9.798902, 48.814353, 421.1],
              [9.799033, 48.814369, 422],
              [9.799136, 48.814413, 422.8],
              [9.799176, 48.814492, 423.6],
              [9.79927, 48.814891, 424.3],
              [9.799357, 48.815161, 423.9],
              [9.799387, 48.815352, 424.7],
              [9.79944, 48.815459, 425.3],
              [9.799644, 48.815757, 427.5],
              [9.799726, 48.815809, 428.2],
              [9.799838, 48.815859, 429.2],
              [9.799952, 48.815887, 430.3],
              [9.800073, 48.81593, 431.8],
              [9.800231, 48.815972, 433.1],
              [9.800355, 48.81597, 433.8],
              [9.800619, 48.815931, 434.8],
              [9.800891, 48.815952, 436],
              [9.80101, 48.815933, 436.6],
              [9.801162, 48.815942, 437.5],
              [9.80128, 48.815919, 438.4],
              [9.801371, 48.815863, 439.2],
              [9.801401, 48.815775, 440.3],
              [9.801351, 48.815568, 441.6],
              [9.801225, 48.815402, 442.2],
              [9.801147, 48.815335, 442.2],
              [9.801039, 48.815262, 442.3],
              [9.800938, 48.815176, 442.3],
              [9.800742, 48.814943, 442.6],
              [9.800507, 48.814756, 443],
              [9.800491, 48.81468, 443.2],
              [9.800573, 48.814577, 443.4],
              [9.800984, 48.814293, 443.7],
              [9.801097, 48.814199, 443.8],
              [9.801412, 48.813894, 444.2],
              [9.801593, 48.813741, 444.4],
              [9.801771, 48.813569, 444.4],
              [9.801851, 48.813506, 444.5],
              [9.801997, 48.813475, 444.6],
              [9.802149, 48.813524, 444.7],
              [9.802318, 48.8136, 444.9],
              [9.80259, 48.813765, 445.2],
              [9.802989, 48.813965, 445.6],
              [9.803286, 48.814154, 446.1],
              [9.80356, 48.814303, 446.5],
              [9.803894, 48.814467, 447.1],
              [9.803985, 48.814548, 447.2],
              [9.804254, 48.814649, 447.5],
              [9.804565, 48.814796, 447.7],
              [9.804841, 48.814889, 448],
              [9.805197, 48.815064, 448.3],
              [9.805451, 48.81517, 448.4],
              [9.805764, 48.815319, 448.5],
              [9.805956, 48.815374, 448.6],
              [9.806118, 48.815334, 448.6],
              [9.806175, 48.815269, 448.5],
              [9.806231, 48.815146, 448.5],
              [9.806304, 48.815029, 448.4],
              [9.806476, 48.814847, 448.1],
              [9.806828, 48.814612, 447.8],
              [9.807049, 48.814506, 447.5],
              [9.807243, 48.814457, 447.3],
              [9.807346, 48.814419, 447.1],
              [9.807489, 48.814293, 446.6],
              [9.80759, 48.814152, 446.1],
              [9.807835, 48.813876, 445.1],
              [9.807926, 48.813824, 445.3],
              [9.80805, 48.813831, 445.5],
              [9.808187, 48.813903, 445.8],
              [9.808317, 48.814001, 446],
              [9.808586, 48.814156, 446.4],
              [9.808872, 48.81426, 446.7],
              [9.808991, 48.814321, 446.8],
              [9.809317, 48.814465, 447.1],
              [9.809469, 48.814547, 447.2],
              [9.809608, 48.814641, 447.4],
              [9.810149, 48.815087, 448],
              [9.810251, 48.815182, 448],
              [9.810888, 48.815878, 448.5],
              [9.810969, 48.815979, 448.5],
              [9.810979, 48.816103, 448.9],
              [9.810951, 48.816204, 449.2],
              [9.810895, 48.816302, 449.5],
              [9.810838, 48.816376, 449.8],
              [9.810665, 48.816534, 450.4],
              [9.810532, 48.816621, 450.8],
              [9.810309, 48.816721, 451.3],
              [9.810238, 48.816781, 451.4],
              [9.810267, 48.816858, 451.4],
              [9.810482, 48.816984, 451.6],
              [9.810616, 48.817042, 451.9],
              [9.811287, 48.817247, 453.8],
              [9.811589, 48.817312, 453.7],
              [9.811556, 48.81741, 453.3],
              [9.811244, 48.817632, 452.3],
              [9.811128, 48.817675, 452.1],
              [9.810907, 48.817824, 451.5],
              [9.810874, 48.81793, 451.4],
              [9.810922, 48.817998, 451.4],
              [9.810964, 48.818098, 451.4],
              [9.810859, 48.818213, 451.5],
              [9.810689, 48.818304, 451.7],
              [9.81053, 48.818369, 451.8],
              [9.810446, 48.818475, 452],
              [9.810427, 48.818669, 452],
              [9.810445, 48.818743, 452],
              [9.810424, 48.818851, 452],
              [9.810348, 48.818957, 452],
              [9.810198, 48.819064, 452.1],
              [9.810067, 48.819224, 452.1],
              [9.810001, 48.819285, 452.1],
              [9.809878, 48.819368, 452.1],
              [9.809681, 48.819459, 452.2],
              [9.809568, 48.819498, 452.2],
              [9.809442, 48.819573, 452.3],
              [9.809355, 48.819641, 452.3],
              [9.809283, 48.819742, 452.4],
              [9.80925, 48.81985, 452.5],
              [9.8092, 48.819919, 452.5],
              [9.808892, 48.820101, 450.5],
              [9.808812, 48.820276, 446.7],
              [9.808701, 48.820336, 447.2],
              [9.808316, 48.82043, 448.1],
              [9.807918, 48.82049, 449.2],
              [9.807797, 48.820527, 449.5],
              [9.807775, 48.820604, 449.8],
              [9.808078, 48.821246, 441.8],
              [9.808301, 48.82136, 438.8],
              [9.808405, 48.821401, 437.3],
              [9.808562, 48.821401, 435.9],
              [9.80869, 48.821413, 434.6],
              [9.80907, 48.821425, 431.5],
              [9.809129, 48.821496, 430.2],
              [9.809163, 48.821578, 429],
              [9.809124, 48.821691, 427.9],
              [9.809038, 48.821768, 427.6],
              [9.80896, 48.821857, 427.3],
              [9.809045, 48.821959, 424.7],
              [9.809171, 48.822044, 422.2],
              [9.809244, 48.822141, 420.4],
              [9.809249, 48.822243, 417.8],
              [9.809147, 48.8224, 416.1],
              [9.808999, 48.822407, 417],
              [9.808947, 48.822483, 416.3],
              [9.808998, 48.822567, 413.6],
              [9.809126, 48.822581, 411.4],
              [9.809231, 48.82261, 409.9],
              [9.809415, 48.822491, 412],
              [9.809524, 48.82244, 411.5],
              [9.809632, 48.822403, 412.2],
              [9.809743, 48.822391, 410.4],
              [9.809827, 48.822441, 407.5],
              [9.809858, 48.822517, 405.5],
              [9.809953, 48.822581, 402.3],
              [9.810062, 48.822611, 400.1],
              [9.810174, 48.822655, 398.5],
              [9.81029, 48.822665, 396.4],
              [9.810378, 48.822711, 395],
              [9.810485, 48.822748, 393.3],
              [9.810519, 48.82282, 392.2],
              [9.810576, 48.822899, 391],
              [9.810695, 48.822932, 389.6],
              [9.810951, 48.822876, 387.4],
              [9.811163, 48.822777, 386.6],
              [9.811321, 48.822648, 386.8],
              [9.810765, 48.822837, 391],
              [9.810374, 48.822615, 399.1],
              [9.810269, 48.82258, 401.6],
              [9.810037, 48.822531, 406],
              [9.809312, 48.822442, 419.1],
              [9.809309, 48.822348, 421.3],
              [9.809369, 48.82227, 422.9],
              [9.809425, 48.822147, 425],
              [9.809434, 48.822059, 425.7],
              [9.809477, 48.821985, 426.5],
              [9.809501, 48.821886, 427.4],
              [9.809502, 48.821789, 428.2],
              [9.809518, 48.821709, 428.7],
              [9.809554, 48.821618, 429.4],
              [9.809538, 48.821448, 430.5],
              [9.809499, 48.821363, 431],
              [9.809423, 48.821106, 432.8],
              [9.809351, 48.821047, 433.2],
              [9.809257, 48.820949, 434.1],
              [9.809112, 48.820883, 435],
              [9.80893, 48.820879, 435.9],
              [9.808798, 48.820904, 436.4],
              [9.80864, 48.820905, 436.9],
              [9.808516, 48.820927, 437.3],
              [9.808411, 48.820969, 437.4],
              [9.808095, 48.821171, 438.8],
              [9.808198, 48.821236, 442.4],
              [9.80895, 48.821504, 433.9],
              [9.809042, 48.821568, 432.8],
              [9.808817, 48.821895, 430.8],
              [9.808938, 48.821988, 428.5],
              [9.80912, 48.822196, 423.8],
              [9.809034, 48.822308, 422.5],
              [9.809351, 48.822632, 414.1],
              [9.809148, 48.820982, 434.2],
              [9.809024, 48.820942, 434.9],
              [9.808849, 48.820827, 436.1],
              [9.808719, 48.820822, 436.6],
              [9.808476, 48.820829, 438.6],
              [9.808449, 48.820739, 439.8],
              [9.80853, 48.820672, 440.8],
              [9.808652, 48.820622, 441.9],
              [9.808739, 48.820567, 442.9],
              [9.808817, 48.820501, 443.9],
              [9.808752, 48.820427, 447.1],
              [9.807647, 48.820587, 450],
              [9.807522, 48.820612, 450.2],
              [9.807428, 48.820653, 450.5],
              [9.807061, 48.820775, 452.1],
              [9.80699, 48.820707, 452],
              [9.807072, 48.820648, 452.1],
              [9.807216, 48.820597, 452],
              [9.807492, 48.820539, 451.9],
              [9.807626, 48.820502, 451.9],
              [9.807866, 48.820415, 451.8],
              [9.808124, 48.820306, 451.9],
              [9.808641, 48.82012, 452.3],
              [9.808753, 48.820072, 452.4],
              [9.808851, 48.820013, 452.5],
              [9.808869, 48.819934, 452.7],
              [9.808739, 48.819905, 452.9],
              [9.808607, 48.819845, 453.2],
              [9.808495, 48.819754, 453.6],
              [9.808265, 48.819649, 454.2],
              [9.808111, 48.819592, 454.4],
              [9.807642, 48.819338, 454.7],
              [9.807492, 48.819279, 454.8],
              [9.80724, 48.819135, 454.8],
              [9.807002, 48.819016, 454.7],
              [9.806745, 48.818872, 454.6],
              [9.806512, 48.818696, 454.3],
              [9.806167, 48.81851, 454],
              [9.805726, 48.818303, 453.3],
              [9.805702, 48.818202, 453.1],
              [9.805653, 48.818103, 451.2],
              [9.805485, 48.818061, 450.9],
              [9.805336, 48.818005, 450.4],
              [9.805203, 48.817939, 450],
              [9.804919, 48.817772, 449.6],
              [9.804796, 48.817723, 449.3],
              [9.804378, 48.81751, 448.5],
              [9.804109, 48.8174, 448.2],
              [9.803924, 48.817307, 448.1],
              [9.803697, 48.817174, 448.1],
              [9.803511, 48.817119, 448.3],
              [9.803411, 48.817057, 448.4],
              [9.803305, 48.817014, 448.6],
              [9.803279, 48.816934, 448.8],
              [9.803293, 48.816791, 448.3],
              [9.80324, 48.816628, 447.5],
              [9.803129, 48.816476, 446.8],
              [9.802988, 48.816339, 446.3],
              [9.80267, 48.81596, 445.3],
              [9.802544, 48.815825, 445.1],
              [9.802406, 48.81565, 444.9],
              [9.802142, 48.815352, 444.4],
              [9.80204, 48.815281, 444.4],
              [9.801858, 48.815299, 443.4],
              [9.801701, 48.815343, 442.9],
              [9.801605, 48.815399, 442.6],
              [9.801485, 48.815447, 442.3],
              [9.800909, 48.815866, 435.6],
              [9.800795, 48.815838, 435.1],
              [9.800443, 48.815791, 433.8],
              [9.799906, 48.81565, 429.5],
              [9.799608, 48.815516, 431.6],
              [9.799237, 48.815256, 434.1],
              [9.799116, 48.8152, 434.7],
              [9.798962, 48.815198, 435.5],
              [9.798848, 48.815215, 435.4],
              [9.798671, 48.815197, 434.1],
              [9.798402, 48.815112, 431.2],
              [9.798193, 48.815009, 429.3],
              [9.798056, 48.81497, 428],
              [9.797961, 48.814917, 426.8],
              [9.79786, 48.814839, 425.4],
              [9.797582, 48.814689, 422.2],
              [9.797299, 48.814518, 418.4],
              [9.797116, 48.814355, 416.5],
              [9.797734, 48.814826, 424.3],
              [9.798061, 48.814876, 427.4],
              [9.798146, 48.814802, 428.9],
              [9.798249, 48.814662, 427.4],
              [9.79848, 48.814549, 425.9],
              [9.798557, 48.814488, 425.2],
              [9.798788, 48.814182, 421.2],
              [9.798824, 48.814108, 421.4],
              [9.79881, 48.813818, 422.5],
              [9.798914, 48.813546, 423.5],
              [9.798998, 48.813437, 424.1],
              [9.79914, 48.8133, 425.1],
              [9.799238, 48.813236, 425.5],
              [9.799845, 48.812635, 427],
              [9.800141, 48.812535, 427.6],
              [9.800412, 48.812472, 427.8],
              [9.800566, 48.81242, 428],
              [9.800685, 48.812365, 428.3],
              [9.800791, 48.812301, 428.5],
              [9.800872, 48.812221, 428.7],
              [9.801067, 48.81196, 428.9],
              [9.801621, 48.811608, 430.4],
              [9.801964, 48.811446, 431.3],
              [9.802226, 48.811272, 430.7],
              [9.802323, 48.811228, 430.4],
              [9.802619, 48.811035, 429.9],
              [9.80296, 48.810849, 430.2],
              [9.803151, 48.810693, 430.2],
              [9.803225, 48.810597, 429.8],
              [9.80331, 48.810433, 428.8],
              [9.803331, 48.810355, 428.3],
              [9.803385, 48.810242, 427.4],
              [9.803468, 48.809901, 425.9],
              [9.803401, 48.809822, 424.5],
              [9.80331, 48.809777, 422.7],
              [9.803167, 48.809637, 418.9],
              [9.802942, 48.809447, 413.5],
              [9.80282, 48.809358, 410.3],
              [9.802671, 48.809303, 406.9],
              [9.802435, 48.809234, 401.8],
              [9.802353, 48.809157, 399.1],
              [9.802242, 48.809026, 394.6],
              [9.80212, 48.808964, 391.6],
              [9.802033, 48.808885, 390.1],
              [9.801908, 48.808876, 388.7],
              [9.801813, 48.808686, 385.6],
              [9.801826, 48.808596, 384.2],
              [9.801825, 48.808476, 381.8],
              [9.801768, 48.808389, 379.5],
              [9.801611, 48.80836, 377.1],
              [9.801529, 48.808293, 375.3],
              [9.801503, 48.808201, 373.3],
              [9.801443, 48.808112, 370.6],
              [9.801307, 48.808103, 367.4],
              [9.801019, 48.808101, 360.5],
              [9.800892, 48.808041, 357.6],
              [9.800861, 48.807765, 353.5],
              [9.801195, 48.807408, 347.6],
              [9.801277, 48.807193, 344.9],
              [9.801307, 48.806939, 341.4],
              [9.801273, 48.806801, 339],
              [9.801033, 48.806317, 333],
              [9.800918, 48.806134, 332.4],
              [9.800902, 48.806041, 332],
              [9.800936, 48.805497, 331],
              [9.800931, 48.804913, 329.5],
              [9.800971, 48.804764, 329.4],
              [9.800738, 48.804615, 330.3],
              [9.800613, 48.804595, 330.4],
              [9.800376, 48.804662, 330.4],
              [9.800117, 48.804587, 330.1],
              [9.799645, 48.804468, 329.7],
              [9.799281, 48.804401, 329.4],
              [9.79593, 48.803053, 325.7],
              [9.794981, 48.802826, 324.6],
              [9.792054, 48.802055, 323.8],
              [9.791809, 48.801435, 322.1],
              [9.791749, 48.801185, 321.9],
              [9.791603, 48.801119, 321.8],
              [9.791559, 48.801029, 321.8],
              [9.791715, 48.800929, 321.8],
              [9.791833, 48.800874, 321.9],
              [9.791941, 48.800798, 321.9]
          ]
      }
  }]
}

const Mapbox = (data) => {
  const { data: geoJson } = data;
  const coordinates = geoJson.features.map(feature => feature.geometry.coordinates);
  const bounds = coordinates.reduce(function (bounds, coord) {
    return bounds.extend(coord);
  }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
  // this ref holds the map DOM node so that we can pass it into Mapbox GL
  const mapNode = useRef(null)

  // this ref holds the map object once we have instantiated it, so that we
  // can use it in other hooks
  const mapRef = useRef(null)
  // construct the map within an effect that has no dependencies
  // this allows us to construct it only once at the time the
  // component is constructed.
  useEffect(() => {
    // Token must be set before constructing map
    mapboxgl.accessToken = mapboxToken
    const map = new mapboxgl.Map({
      container: mapNode.current,
      style: 'mapbox://styles/mapbox/outdoors-v11',
      bounds,
      fitBoundsOptions: (bounds, { padding: 20 }),
    });

    mapRef.current = map
    map.addControl(new mapboxgl.NavigationControl(), 'top-right')

    map.on('load', () => {
      // add sources
      map.addSource('route', {
        type: 'geojson',
        data: geoJson,
      });
      map.addLayer({
        id: 'route',
        type: 'line',
        source: 'route',
        layout: {
          'line-join': 'round',
          'line-cap': 'round',
        },
        paint: {
          'line-color': [
            'get', 'color',
          ],
          'line-width': 2,
        },
      });
    })

    // hook up map events here, such as click, mouseenter, mouseleave
    // e.g., map.on('click', (e) => {})

    // when this component is destroyed, remove the map
    return () => {
      map.remove();
    };
  }, [bounds, geoJson])

  // You can use other `useEffect` hooks to update the state of the map
  // based on incoming props.  Just beware that you might need to add additional
  // refs to share objects or state between hooks.
  return (
    <div ref={mapNode} style={{ height: '400px' }} />
  );
};

const MapboxWrapper = () => {
  const { value } = useUiExtension();
  return (
    <Mapbox data={value} />
  )
};

const declaration = {
  extensionType: 'field',
  fieldType: FieldExtensionType.JSON,
  name: 'Mapbox GeoJson Visualizer',
  description: 'Visualize GeoJson in Mapbox',
  features: [FieldExtensionFeature.FieldRenderer],
};

export default function App() {
  const environment = process.env.NODE_ENV;
  if (environment === 'development') {
    return (
      <Mapbox data={geoJson} />
    );
  } else {
    const queryParams = new URLSearchParams(window.location.search);
    const uid = queryParams.get('extensionUid');
    return (
      <Wrapper uid={uid} declaration={declaration}>
        <MapboxWrapper />
      </Wrapper>
    );
  }
}